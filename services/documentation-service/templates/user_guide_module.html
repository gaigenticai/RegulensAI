{% extends "base.html" %}

{% block title %}{{ module.name }} - User Guide{% endblock %}

{% block description %}Complete user guide for {{ module.name }} with workflows, field references, examples, and troubleshooting{% endblock %}

{% block extra_head %}
<style>
    .module-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }
    .sidebar-nav {
        position: sticky;
        top: 80px;
        max-height: calc(100vh - 100px);
        overflow-y: auto;
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1rem;
    }
    .content-section {
        margin-bottom: 3rem;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .workflow-step {
        background: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 0 8px 8px 0;
        position: relative;
    }
    .step-number {
        position: absolute;
        top: -10px;
        left: -15px;
        background: #007bff;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.9rem;
    }
    .field-reference {
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 1.5rem;
        margin: 1rem 0;
    }
    .field-name {
        font-family: 'Courier New', monospace;
        font-weight: bold;
        color: #007bff;
        font-size: 1.1rem;
    }
    .field-type {
        background: #e9ecef;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-left: 0.5rem;
    }
    .required-badge {
        background: #dc3545;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-left: 0.5rem;
    }
    .code-example {
        background: #2d3748;
        color: #e2e8f0;
        padding: 1.5rem;
        border-radius: 8px;
        overflow-x: auto;
        margin: 1rem 0;
        position: relative;
    }
    .copy-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #4a5568;
        border: none;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.8rem;
        cursor: pointer;
    }
    .troubleshooting-item {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 1.5rem;
        margin: 1rem 0;
    }
    .nav-link.active {
        background: #007bff;
        color: white !important;
        border-radius: 5px;
    }
    .screenshot-placeholder {
        background: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        color: #6c757d;
        margin: 1rem 0;
    }
    .tip-box {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
    }
    .warning-box {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Module Header -->
<div class="module-header">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/user-guide" class="text-white-50">User Guide</a></li>
                <li class="breadcrumb-item active text-white">{{ module.name }}</li>
            </ol>
        </nav>
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 mb-3">{{ module.name }}</h1>
                <p class="lead mb-4">{{ module.description }}</p>
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-light text-dark">Active Module</span>
                    <span class="badge bg-light text-dark">Production Ready</span>
                    <span class="badge bg-light text-dark">Full Documentation</span>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="bg-white bg-opacity-10 rounded p-3">
                    <h3 class="mb-1">{{ workflows | length }}</h3>
                    <small>Workflows Available</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-lg-3">
            <div class="sidebar-nav">
                <h6 class="text-muted mb-3">Navigation</h6>
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#overview">
                        <i class="fas fa-info-circle me-2"></i>Overview
                    </a>
                    <a class="nav-link" href="#getting-started">
                        <i class="fas fa-play-circle me-2"></i>Getting Started
                    </a>
                    <a class="nav-link" href="#workflows">
                        <i class="fas fa-project-diagram me-2"></i>Workflows
                    </a>
                    <a class="nav-link" href="#field-reference">
                        <i class="fas fa-list me-2"></i>Field Reference
                    </a>
                    <a class="nav-link" href="#examples">
                        <i class="fas fa-code me-2"></i>Examples
                    </a>
                    <a class="nav-link" href="#troubleshooting">
                        <i class="fas fa-tools me-2"></i>Troubleshooting
                    </a>
                </nav>
                
                <hr class="my-3">
                
                <h6 class="text-muted mb-3">Quick Actions</h6>
                <div class="d-grid gap-2">
                    <a href="/search?category={{ module.id }}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-search me-1"></i>Search Module
                    </a>
                    <a href="/api-reference/{{ module.id }}" class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-code me-1"></i>API Reference
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9">
            <!-- Overview Section -->
            <section id="overview" class="content-section">
                <h2><i class="fas fa-info-circle me-2"></i>Module Overview</h2>
                <p class="lead">{{ module.overview }}</p>
                
                <div class="row">
                    <div class="col-md-6">
                        <h4>Key Features</h4>
                        <ul class="list-unstyled">
                            {% for feature in module.key_features %}
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                {{ feature }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h4>Prerequisites</h4>
                        <ul class="list-unstyled">
                            {% for prerequisite in module.prerequisites %}
                            <li class="mb-2">
                                <i class="fas fa-arrow-right text-primary me-2"></i>
                                {{ prerequisite }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Getting Started Section -->
            <section id="getting-started" class="content-section">
                <h2><i class="fas fa-play-circle me-2"></i>Getting Started</h2>
                <p>{{ module.getting_started }}</p>
                
                <div class="tip-box">
                    <h6><i class="fas fa-lightbulb me-2"></i>Pro Tip</h6>
                    <p class="mb-0">Start with the basic workflow to familiarize yourself with the interface before moving to advanced features.</p>
                </div>
            </section>

            <!-- Workflows Section -->
            <section id="workflows" class="content-section">
                <h2><i class="fas fa-project-diagram me-2"></i>Step-by-Step Workflows</h2>
                
                {% for workflow in workflows %}
                <div class="mb-4">
                    <h3>{{ workflow.title }}</h3>
                    <p>{{ workflow.description }}</p>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                Estimated time: {{ workflow.estimated_time }} minutes
                            </small>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>
                                Required permissions: {{ workflow.required_permissions | join(", ") }}
                            </small>
                        </div>
                    </div>
                    
                    {% for step in workflow.steps %}
                    <div class="workflow-step">
                        <div class="step-number">{{ step.step_number }}</div>
                        <h5>{{ step.title }}</h5>
                        <p>{{ step.description }}</p>
                        
                        <div class="mb-3">
                            <strong>Instructions:</strong>
                            <p>{{ step.instructions }}</p>
                        </div>
                        
                        {% if step.screenshot_url %}
                        <div class="screenshot-placeholder">
                            <i class="fas fa-image fa-2x mb-2"></i>
                            <p>Screenshot: {{ step.title }}</p>
                            <small class="text-muted">{{ step.screenshot_url }}</small>
                        </div>
                        {% endif %}
                        
                        {% if step.tips %}
                        <div class="tip-box">
                            <h6><i class="fas fa-lightbulb me-2"></i>Tips</h6>
                            <ul class="mb-0">
                                {% for tip in step.tips %}
                                <li>{{ tip }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                        
                        <div class="mt-3">
                            <strong>Expected Outcome:</strong>
                            <p class="mb-0">{{ step.expected_outcome }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </section>

            <!-- Field Reference Section -->
            <section id="field-reference" class="content-section">
                <h2><i class="fas fa-list me-2"></i>Field Reference Guide</h2>
                <p>Complete reference for all data fields with descriptions, validation rules, and examples.</p>
                
                {% for field in field_references %}
                <div class="field-reference">
                    <div class="d-flex align-items-center mb-2">
                        <span class="field-name">{{ field.field_name }}</span>
                        <span class="field-type">{{ field.field_type }}</span>
                        {% if field.required %}
                        <span class="required-badge">Required</span>
                        {% endif %}
                    </div>
                    
                    <p>{{ field.description }}</p>
                    
                    {% if field.validation_rules %}
                    <div class="mb-2">
                        <strong>Validation Rules:</strong>
                        <ul class="mb-0">
                            {% for rule in field.validation_rules %}
                            <li>{{ rule }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if field.example_values %}
                    <div class="mb-2">
                        <strong>Example Values:</strong>
                        <code>{{ field.example_values | join(", ") }}</code>
                    </div>
                    {% endif %}
                    
                    {% if field.related_fields %}
                    <div>
                        <strong>Related Fields:</strong>
                        {% for related in field.related_fields %}
                        <span class="badge bg-secondary me-1">{{ related }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </section>

            <!-- Examples Section -->
            <section id="examples" class="content-section">
                <h2><i class="fas fa-code me-2"></i>Usage Examples</h2>
                
                {% for example in examples %}
                <div class="mb-4">
                    <h4>{{ example.title }}</h4>
                    <p>{{ example.description }}</p>
                    
                    <div class="code-example">
                        <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        <pre><code class="language-{{ example.language }}">{{ example.code }}</code></pre>
                    </div>
                    
                    {% if example.expected_output %}
                    <div class="mt-3">
                        <strong>Expected Output:</strong>
                        <div class="code-example">
                            <pre><code>{{ example.expected_output }}</code></pre>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if example.notes %}
                    <div class="tip-box">
                        <h6><i class="fas fa-info-circle me-2"></i>Notes</h6>
                        <ul class="mb-0">
                            {% for note in example.notes %}
                            <li>{{ note }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </section>

            <!-- Troubleshooting Section -->
            <section id="troubleshooting" class="content-section">
                <h2><i class="fas fa-tools me-2"></i>Troubleshooting Guide</h2>
                
                {% for item in troubleshooting %}
                <div class="troubleshooting-item">
                    <h4><i class="fas fa-exclamation-triangle me-2"></i>{{ item.title }}</h4>
                    <p>{{ item.description }}</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Possible Causes:</h6>
                            <ul>
                                {% for cause in item.causes %}
                                <li>{{ cause }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Solutions:</h6>
                            <ol>
                                {% for solution in item.solutions %}
                                <li>{{ solution }}</li>
                                {% endfor %}
                            </ol>
                        </div>
                    </div>
                    
                    {% if item.related_links %}
                    <div class="mt-3">
                        <strong>Related Documentation:</strong>
                        {% for link in item.related_links %}
                        <a href="{{ link }}" class="btn btn-sm btn-outline-primary me-2">View Guide</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="mt-2">
                        <span class="badge bg-{{ item.severity | lower }}">{{ item.severity }} Priority</span>
                    </div>
                </div>
                {% endfor %}
            </section>
        </div>
    </div>
</div>

<script>
// Smooth scrolling for navigation links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Copy to clipboard functionality
function copyToClipboard(button) {
    const codeBlock = button.nextElementSibling.querySelector('code');
    const text = codeBlock.textContent;
    
    navigator.clipboard.writeText(text).then(() => {
        button.textContent = 'Copied!';
        setTimeout(() => {
            button.textContent = 'Copy';
        }, 2000);
    });
}

// Update active navigation based on scroll
window.addEventListener('scroll', () => {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.sidebar-nav .nav-link');
    
    let current = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop - 100;
        if (window.pageYOffset >= sectionTop) {
            current = section.getAttribute('id');
        }
    });

    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${current}`) {
            link.classList.add('active');
        }
    });
});
</script>
{% endblock %}
